<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misinformation Detective</title>
    <style>
        :root {
            --teal: #86d4cf;
            --sage: #77af91;
            --red: #d48686;
            --gold: #ffd700;
            --white: #ffffff;
            --gray: #f5f5f5;
            --dark-gray: #333333;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: Garamond, serif;
            margin: 0;
            padding: 0;
            background-color: var(--white);
            color: var(--dark-gray);
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(to right, var(--sage), var(--teal));
            padding: 15px;
            text-align: center;
            font-family: Georgia, serif;
            color: var(--white);
            position: relative;
        }
        
        .back-btn {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--white);
            font-size: 16px;
            cursor: pointer;
        }
        
        .xp-counter {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        /* Homepage Styles */
        .homepage {
            text-align: center;
        }
        
        .exercise-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .exercise-card {
            background-color: var(--white);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
            cursor: pointer;
            position: relative;
            border: 2px solid transparent;
        }
        
        .exercise-card:hover {
            transform: translateY(-5px);
            border-color: var(--teal);
        }
        
        .exercise-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .exercise-card.completed {
            border-color: var(--sage);
        }
        
        .exercise-icon {
            font-size: 40px;
            margin-bottom: 10px;
            color: var(--sage);
        }
        
        .exercise-title {
            font-family: Georgia, serif;
            margin: 10px 0;
        }
        
        .exercise-xp {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--teal);
            color: white;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        .exercise-completed {
            position: absolute;
            top: 10px;
            left: 10px;
            color: var(--sage);
        }
        
        /* Exercise Common Styles */
        .exercise-container {
            display: none;
        }
        
        .question-card {
            background-color: var(--white);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .exercise-image {
            max-width: 100%;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
        }
        
        .options-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .option-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            font-family: Garamond, serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .feedback-panel {
            background-color: var(--gray);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }
        
        .feedback-correct {
            border-left: 4px solid var(--sage);
        }
        
        .feedback-incorrect {
            border-left: 4px solid var(--red);
        }
        
        .progress-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #ccc;
            margin: 0 5px;
        }
        
        .progress-dot.active {
            background-color: var(--teal);
        }
        
        .reset-btn {
            display: block;
            margin: 20px auto;
            padding: 8px 20px;
            background-color: var(--red);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }
        
        .completion-screen {
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .xp-bar-container {
            width: 100%;
            height: 20px;
            background-color: #eee;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .xp-bar {
            height: 100%;
            background: linear-gradient(to right, var(--teal), var(--sage));
            width: 0%;
            transition: width 0.5s;
        }
        
        /* Reset button style */
        .reset-container {
            text-align: center;
            margin: 20px 0;
        }

        /* Specific Exercise Styles */
        /* Exercise 2: Identify Biases */
        .bias-category {
            margin-bottom: 20px;
        }
        
        .bias-category h3 {
            font-family: Georgia, serif;
            color: var(--sage);
        }
        
        .bias-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: Garamond, serif;
            min-height: 60px;
        }
        
        .add-bias-btn {
            background-color: var(--teal);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            margin: 10px 0;
        }
        
        /* Exercise 3: Spot the Bias */
        .passage-container {
            margin-bottom: 30px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid var(--teal);
        }
        
        .passage-title {
            font-family: Georgia, serif;
            color: var(--sage);
            margin-bottom: 10px;
        }
        
        .biased-phrase {
            cursor: pointer;
            transition: background-color 0.2s;
            padding: 0 2px;
        }
        
        .biased-phrase:hover {
            background-color: rgba(255, 255, 0, 0.3);
        }
        
        .biased-phrase.found {
            background-color: rgba(134, 212, 207, 0.5);
        }
        
        .found-count {
            font-weight: bold;
            color: var(--sage);
        }
        
        /* Popup styles */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 100;
            display: none;
        }
        
        .explanation-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 80%;
            width: 500px;
            z-index: 101;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            display: none;
        }
        
        .explanation-popup h3 {
            margin-top: 0;
            color: var(--sage);
        }
        
        .close-popup {
            background-color: var(--teal);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 15px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .exercise-grid {
                grid-template-columns: 1fr;
            }
            
            .options-container {
                flex-direction: column;
            }
            
            .option-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="back-btn" id="back-btn">‚Üê Back</button>
        <h1 id="header-title">Misinformation Detective</h1>
        <div class="xp-counter">XP: <span id="xp">0</span></div>
    </div>
    
    <div class="container">
        <!-- Homepage -->
        <div class="homepage" id="homepage">
            <h2>Choose an Exercise</h2>
            <div class="xp-bar-container">
                <div class="xp-bar" id="xp-bar"></div>
            </div>
            <div class="exercise-grid" id="exercise-grid">
                <!-- Exercises will be added by JavaScript -->
            </div>
        </div>
        
        <!-- Reset Button Container -->
        <div class="reset-container">
            <button class="reset-btn" id="reset-btn">Reset All Progress</button>
        </div>
        
        <!-- Exercise 1: Fact or Opinion -->
        <div class="exercise-container" id="exercise-1">
            <h2>Fact or Opinion?</h2>
            <p>Read the sentences from the article, "MANY OF THE PRODUCTS MILLENNIALS ARE KILLING DESERVE TO DIE" below. Identify whether each statement is a fact or opinion.</p>
            
            <div class="question-card" data-correct="fact">
                <p>"Canned tuna consumption is down 42 percent per capita over the past 30 years."</p>
                <div class="options-container">
                    <button class="option-btn fact-btn">Fact</button>
                    <button class="option-btn opinion-btn">Opinion</button>
                </div>
                <div class="feedback-panel">
                    <p>Correct! This is a <strong>fact</strong> that you can verify with a little research.</p>
                </div>
            </div>
        
            <div class="question-card" data-correct="opinion">
                <p>"Millennials have good taste."</p>
                <div class="options-container">
                    <button class="option-btn fact-btn">Fact</button>
                    <button class="option-btn opinion-btn">Opinion</button>
                </div>
                <div class="feedback-panel">
                    <p>Correct! This is an <strong>opinion</strong> based on the author's personal dislike of products millennials are no longer buying, like canned tuna.</p>
                </div>
            </div>
        
            <div class="question-card" data-correct="fact">
                <p>"This is a generation that's making far less money than their parents did. It can't afford big-ticket items like houses, marriages, or children."</p>
                <div class="options-container">
                    <button class="option-btn fact-btn">Fact</button>
                    <button class="option-btn opinion-btn">Opinion</button>
                </div>
                <div class="feedback-panel">
                    <p>Correct! This is a <strong>fact</strong>, you could do research on income levels across time to verify this.</p>
                </div>
            </div>
        
            <div class="question-card" data-correct="fact">
                <p>"Millennials are spending their few coins on vacations and avocado toast."</p>
                <div class="options-container">
                    <button class="option-btn fact-btn">Fact</button>
                    <button class="option-btn opinion-btn">Opinion</button>
                </div>
                <div class="feedback-panel">
                    <p>Correct! This is a <strong>fact</strong>, you could do research on spending habits to verify this.</p>
                </div>
            </div>
        
            <div class="question-card" data-correct="opinion">
                <p>"Those are better choices than canned tuna, golf, and fabric softener."</p>
                <div class="options-container">
                    <button class="option-btn fact-btn">Fact</button>
                    <button class="option-btn opinion-btn">Opinion</button>
                </div>
                <div class="feedback-panel">
                    <p>Correct! This is an <strong>opinion</strong> based on the author's personal interests.</p>
                </div>
            </div>
        
            <div class="question-card" data-correct="opinion">
                <p>"Many of the products that Millennials are killing deserve to die."</p>
                <div class="options-container">
                    <button class="option-btn fact-btn">Fact</button>
                    <button class="option-btn opinion-btn">Opinion</button>
                </div>
                <div class="feedback-panel">
                    <p>Correct! This is an <strong>opinion</strong>, the writer's dislike of these products is not a verifiable way of measuring which products "deserve to die" and which do not.</p>
                </div>
            </div>
        
            <div class="question-card" data-correct="opinion">
                <p>"The kids are more than all right-they're wiser than their elders, who should have left them a better country while they had the chance."</p>
                <div class="options-container">
                    <button class="option-btn fact-btn">Fact</button>
                    <button class="option-btn opinion-btn">Opinion</button>
                </div>
                <div class="feedback-panel">
                    <p>Correct! This is an <strong>opinion</strong> filled with descriptive and judgment based language.</p>
                </div>
            </div>
        
            <div class="completion-screen" id="completion-1">
                <h2>Exercise Complete!</h2>
                <p>You got <span id="score-1">0</span>/7 correct.</p>
                <p>Earned <span id="earned-xp-1">0</span> XP this session.</p>
                <button class="back-btn">Return to Exercises</button>
            </div>
        </div>
        
        <!-- Exercise 2: Identify Your Biases -->
        <div class="exercise-container" id="exercise-2">
            <h2>Identify Your Biases</h2>
            <p>List factors that shape how you interpret information and how they might influence you.</p>
        
            <div id="bias-categories-container">
                <div class="bias-category">
                    <h3>Where You Live</h3>
                    <textarea class="bias-input" placeholder="How might your location affect what news you trust?"></textarea>
                </div>
            
                <div class="bias-category">
                    <h3>Gender Identity</h3>
                    <textarea class="bias-input" placeholder="How might your gender influence your perspectives?"></textarea>
                </div>
            
                <div class="bias-category">
                    <h3>Race/Ethnicity</h3>
                    <textarea class="bias-input" placeholder="How might your racial identity shape your views?"></textarea>
                </div>
            
                <div class="bias-category">
                    <h3>Age</h3>
                    <textarea class="bias-input" placeholder="How might your age affect your interpretation?"></textarea>
                </div>
            
                <div class="bias-category">
                    <h3>Religion</h3>
                    <textarea class="bias-input" placeholder="How might your religious views influence you?"></textarea>
                </div>
            </div>
        
            <button class="add-bias-btn" id="add-bias-btn">+ Add Another Bias</button>
        
            <div class="question-card">
                <h3>Why This Matters</h3>
                <p>Recognizing your biases helps you identify when they might distort your interpretation of information. We all have lenses that shape how we see the world - the key is being aware of them.</p>
            </div>
        
            <button class="option-btn" id="submit-biases" style="background-color: var(--sage); color: white;">Submit</button>
        
            <div class="completion-screen" id="completion-2">
                <h2>Reflection Submitted!</h2>
                <p>You've earned <span id="earned-xp-2">30</span> XP for completing this exercise.</p>
                <button class="back-btn">Return to Exercises</button>
            </div>
        </div>
        
        <!-- Exercise 3: Spot the Bias - Updated with two passages -->
        <div class="exercise-container" id="exercise-3">
            <h2>Spot the Bias</h2>
            <p>Click on biased phrases in the texts below. Correct selections will show explanations.</p>
    
            <!-- Passage 1 - 11 sections (7 biased) -->
            <div class="passage-container">
                <h3 class="passage-title">Passage 1</h3>
                <div class="biased-text">
                    <p>
                        <span class="biased-phrase" data-biased="true" data-explanation="With a quick internet search on this outlet, you'll find that it is an American conservative news and opinion website.">
                            [1] Link: https://dailycaller.com/2019/03/15/children-strike-school-climate-change/</span><br>
                        <span class="biased-phrase" data-biased="true" data-explanation="Headline is based on the author's own personal views, because the word 'alarmist' is not attributed to an expert or cited with evidence.">
                            [2] JUST 12 YEARS LEFT? LET'S BREAK DOWN THE ALARMIST TALKING POINT FUELING KIDS' CLIMATE CHANGE STRIKES</span><br>
                        <span class="biased-phrase" data-biased="true" data-explanation="Judgment heavy language to paint participants as immature and manipulated by adults.">
                            [3] Thousands of students will skip school Friday over global warming as part of an international movement backed by adult activists and based on a misreading of the latest United Nations climate report.</span>
                        <span class="biased-phrase" data-biased="false">
                            [4] The student strikes were inspired by 16-year-old Greta Thunberg, </span>
                        <span class="biased-phrase" data-biased="true" data-explanation="Uses words like 'ditching school' in a way that's meant to tell us this is all a bad thing.">
                            [5] who began ditching school in August to sit in protest outside Swedish parliment.</span>
                        <span class="biased-phrase" data-biased="false">
                            [6] Student activists' alarm isn't surprising-</span>
                        <span class="biased-phrase" data-biased="true" data-explanation="Author provides no evidence of this correlation.">
                            [7] it's been nurtured by the media, climate activists and politicians in the wake of a U.N. report released in October.</span>
                        <span class="biased-phrase" data-biased="false">
                            [8] The U.N. special report stated emissions needed to fall 45 percent below 2010 levels by 2030, and then for emissions to reach zero by 2050 to avoid warming above 1.5 degrees Celsius by 2100.</span>
                        <span class="biased-phrase" data-biased="true" data-explanation="Provides no evidence of this, suggesting this is based on the author's own personal views.">
                            [9] (And that's if you put faith in the U.N.'s climate models, which have been shown to overestimate warming by as much as 50 percent.)</span>
                        <span class="biased-phrase" data-biased="false">
                            [10] Is 1.5 to 2 degrees of warming catastrophic? The U.N.'s projections suggest no, but </span>
                        <span class="biased-phrase" data-biased="true" data-explanation="Could have provided evidence, but doesn't. Suggests he is cherry-picking and interpreting his own claim.">
                            [11] the media framed it as a 12-year deadline to prevent climate change catastrophe.</span>
                    </p>
                </div>
                <p>Found <span class="found-count">0</span>/7 biased phrases</p>
            </div>
    
            <!-- Passage 2 - 10 sections (4 biased) -->
            <div class="passage-container">
                <h3 class="passage-title">Passage 2</h3>
                <div class="biased-text">
                    <p>
                        <span class="biased-phrase" data-biased="true" data-explanation="Characterized as leaning slightly left of center.">
                            [1] Link: https://thehill.com/policy/energy-environment/434260-youth-activists-across-globe-protest-for-climate-action</span><br>
                        <span class="biased-phrase" data-biased="false">
                            [2] YOUTH ACTIVISTS ACROSS GLOBE PROTEST FOR CLIMATE ACTION</span><br>
                        <span class="biased-phrase" data-biased="true" data-explanation="Language like 'inevitable effects of climate change' is a sign of a liberal outlet.">
                            [3] Protests erupted across the globe on Friday led by youth activists demanding governments take action to thwart the inevitable effects of climate change.</span>
                        <span class="biased-phrase" data-biased="false">
                            [4] From Israel to South Africa to the U.S., thousands of student protesters rallied at school campuses and their civic centers asking for federal and international action to address global warming-</span>
                        <span class="biased-phrase" data-biased="true" data-explanation="Not an outright sign of bias, but the author could have attributed this fact to experts who have written extensively on the effects of climate change on younger generations so that it did not look like a personal view from the author.">
                            [5] the effects of which could greatly impact younger generations.</span>
                        <span class="biased-phrase" data-biased="false">
                            [6] In Cape Town, students in uniforms held signs, one which read, "Denial is not a policy."</span>
                        <span class="biased-phrase" data-biased="false">
                            [7] In Lebanon, a sign at a rally announced, "You really know how to make me cry when you make those oceans rise."</span>
                        <span class="biased-phrase" data-biased="false">
                            [8] In Hong Kong, it was reported that Friday's climate strike amounted to the city's largest environmental rally in history, with an estimated 1,000 students taking to the streets holding signs including one reading, "Our children will be endangered species."</span>
                        <span class="biased-phrase" data-biased="true" data-explanation="Since much of the language up to this point has painted a vivid picture of a worldwide movement in which the students are brave heroes-rallied, taking to the streets-the mention of skipping school doesn't carry the same judgment. By the time readers reach that phrase, they already believe the protests are for a good cause, because the paragraphs before got us emotionally invested.">
                            [9] In many instances, students skipped school to attend protests.</span>
                        <span class="biased-phrase" data-biased="false">
                            [10] Friday's protests also come the same week that the United Nations released two new scientific reports warning that the effects of global warming and sea level rise may be even more unavoidable than previously measured.</span>
                    </p>
                </div>
                <p>Found <span class="found-count">0</span>/4 biased phrases</p>
            </div>
    
            <div class="completion-screen" id="completion-3">
                <h2>Exercise Complete!</h2>
                <p>You found <span id="score-3">0</span>/11 biased phrases.</p>
                <p>Earned <span id="earned-xp-3">0</span> XP this session.</p>
                <button class="back-btn">Return to Exercises</button>
            </div>
    
            <!-- Popup Elements -->
            <div class="overlay" id="explanation-overlay"></div>
            <div class="explanation-popup" id="explanation-popup">
                <h3>Why This is Biased</h3>
                <p id="explanation-text"></p>
                <button class="close-btn" id="close-explanation">Close</button>
            </div>
        </div>
        
        <!-- Exercise 4-8 containers would follow similar patterns -->
        
        <!-- Completion Screen for All Exercises -->
        <div class="completion-screen" id="global-completion">
            <h2>Exercise Complete!</h2>
            <p>You earned <span id="earned-xp-total">0</span> XP this session.</p>
            <p>Total XP: <span id="total-xp">0</span></p>
            <button class="back-btn">Return to Exercises</button>
        </div>
    </div>

    <script>
        // Game Data
        const exercises = [
            {
                id: 1,
                title: "Fact or Opinion",
                icon: "‚ùì",
                description: "Classify statements from news articles",
                xp: 70,
                completed: false,
                unlocked: true,
                xpEarned: 0
            },
            {
                id: 2,
                title: "Identify Your Biases",
                icon: "üëÅÔ∏è",
                description: "Reflect on personal lenses",
                xp: 30,
                completed: false,
                unlocked: false,
                xpEarned: 0
            },
            {
                id: 3,
                title: "Spot the Bias",
                icon: "üîç",
                description: "Find biased phrases in text",
                xp: 55,
                completed: false,
                unlocked: false,
                xpEarned: 0
            },
            // More exercises...
        ];

        const biasPatterns = {
            passage1: [true, true, true, false, true, false, true, false, true, false, true], // 7 true
            passage2: [true, false, true, false, true, false, false, false, true, false] // 4 true
        };

        // Game State 
        let currentExercise = null;
        let xp = 0;
        let level = 1;
        const xpPerLevel = 100;
        let answeredQuestions = 0;
        let correctAnswers = 0;
        
        // DOM Elements
        const homepage = document.getElementById('homepage');
        const exerciseContainers = document.querySelectorAll('.exercise-container');
        const backBtn = document.getElementById('back-btn');
        const xpDisplay = document.getElementById('xp');
        const xpBar = document.getElementById('xp-bar');
        const exerciseGrid = document.getElementById('exercise-grid');
        const headerTitle = document.getElementById('header-title');

        // Initialize Game
        function initGame() {
            loadProgress();
            renderExercises();
            setupEventListeners();
    
            // Initialize Exercise 3 when its container is displayed
            const exercise3Container = document.getElementById('exercise-3');
            const observer = new MutationObserver(function(mutations) {
                if (exercise3Container.style.display === 'block') {
                    initExercise3();
                    observer.disconnect(); // Stop observing after initialization
                }
            });
            observer.observe(exercise3Container, { attributes: true, attributeFilter: ['style'] });
    
            // Dim completed exercises
            exercises.forEach(ex => {
                if (ex.completed) {
                    const exerciseElement = document.getElementById(`exercise-${ex.id}`);
                    if (exerciseElement) {
                        exerciseElement.querySelectorAll('.option-btn, .biased-phrase').forEach(el => {
                            el.style.opacity = '0.6';
                            el.style.cursor = 'default';
                            el.onclick = null;
                        });
                    }
                }
            });
        }

        // Load saved progress
        function loadProgress() {
            const savedData = localStorage.getItem('misinfoGameProgress');
            if (savedData) {
                const data = JSON.parse(savedData);
                xp = data.xp || 0;
                level = data.level || 1;
                
                if (data.exercises) {
                    exercises.forEach(ex => {
                        const savedEx = data.exercises.find(e => e.id === ex.id);
                        if (savedEx) {
                            ex.completed = savedEx.completed;
                            ex.unlocked = savedEx.unlocked;
                        }
                    });
                }
            }
            
            updateXPDisplay();
        }

        // Save progress
        function saveProgress() {
            const data = {
                xp: xp,
                level: level,
                exercises: exercises.map(ex => ({
                    id: ex.id,
                    completed: ex.completed,
                    unlocked: ex.unlocked
                }))
            };
            localStorage.setItem('misinfoGameProgress', JSON.stringify(data));
        }

        // Render exercise grid
        function renderExercises() {
            exerciseGrid.innerHTML = '';
            
            exercises.forEach(exercise => {
                const card = document.createElement('div');
                card.className = `exercise-card ${exercise.completed ? 'completed' : ''} ${!exercise.unlocked ? 'locked' : ''}`;
                card.dataset.id = exercise.id;
                
                card.innerHTML = `
                    <div class="exercise-icon">${exercise.icon}</div>
                    <h3 class="exercise-title">${exercise.title}</h3>
                    <p>${exercise.description}</p>
                    <div class="exercise-xp">${exercise.xp} XP</div>
                    ${exercise.completed ? '<div class="exercise-completed">‚úì</div>' : ''}
                `;
                
                if (exercise.unlocked) {
                    card.addEventListener('click', () => startExercise(exercise.id));
                }
                
                exerciseGrid.appendChild(card);
            });
        }

        // Start an exercise
        function startExercise(id) {
            const exercise = exercises.find(ex => ex.id === id);
            if (!exercise) return;
            
            currentExercise = exercise;
            homepage.style.display = 'none';
            document.getElementById(`exercise-${id}`).style.display = 'block';
            headerTitle.textContent = exercise.title;
        }

        // Complete an exercise
        function completeExercise(id, earnedXp) {
            const exercise = exercises.find(ex => ex.id === id);
            if (!exercise) return;
            
            exercise.completed = true;
            
            // Only award XP if not already earned
            if (exercise.xpEarned === 0) {
                exercise.xpEarned = earnedXp;
                xp += earnedXp;
            }
            
            // Unlock next exercise if available
            const nextExIndex = exercises.findIndex(ex => ex.id === id) + 1;
            if (nextExIndex < exercises.length) {
                exercises[nextExIndex].unlocked = true;
            }
            
            checkLevelUp();
            updateXPDisplay();
            saveProgress();
            
            // Show completion screen
            document.getElementById(`exercise-${id}`).querySelector('.completion-screen').style.display = 'block';
            document.getElementById(`earned-xp-${id}`).textContent = exercise.xpEarned;
        }

        // Return to homepage
        function returnToHomepage() {
            currentExercise = null;
            homepage.style.display = 'block';
            exerciseContainers.forEach(container => {
                container.style.display = 'none';
                container.querySelector('.completion-screen').style.display = 'none';
            });
            headerTitle.textContent = 'Misinformation Detective';
            renderExercises();
        }

        // Check if player leveled up
        function checkLevelUp() {
            const neededXp = level * xpPerLevel;
            if (xp >= neededXp) {
                level++;
                // Could add level up animation here
            }
        }

        // Update XP display
        function updateXPDisplay() {
            xpDisplay.textContent = xp;
            const neededXp = level * xpPerLevel;
            const xpPercent = Math.min(100, (xp / neededXp) * 100);
            xpBar.style.width = `${xpPercent}%`;
        }

        // Reset Progress Function
        function resetProgress() {
            if (confirm('Are you sure you want to reset ALL progress? This cannot be undone.')) {
                // Clear localStorage
                localStorage.removeItem('misinfoGameProgress');
        
                // Reset all game state variables
                xp = 0;
                level = 1;
                answeredQuestions = 0;
                correctAnswers = 0;
        
                // Reset exercise states
                exercises.forEach(ex => {
                    ex.completed = false;
                    ex.xpEarned = 0;
                    ex.unlocked = ex.id === 1; // Only first exercise unlocked by default
                });
        
                // Update UI
                updateXPDisplay();
                renderExercises();
        
                // Reset all exercise states
                document.querySelectorAll('.completion-screen').forEach(el => {
                    el.style.display = 'none';
                });
        
                // Reset Exercise 3 specifically
                const exercise3 = document.getElementById('exercise-3');
                if (exercise3) {
                    // Reset counters
                    exercise3.querySelectorAll('.found-count').forEach(el => {
                        el.textContent = '0';
                    });
                    document.getElementById('score-3').textContent = '0';
                    document.getElementById('earned-xp-3').textContent = '0';
            
                    // Reset found phrases
                    exercise3.querySelectorAll('.biased-phrase.found').forEach(el => {
                        el.classList.remove('found');
                    });
                }
        
                // Show homepage and hide all exercises
                homepage.style.display = 'block';
                document.querySelectorAll('.exercise-container').forEach(el => {
                    el.style.display = 'none';
                });
        
                // Reinitialize the first exercise
                const firstExercise = document.getElementById('exercise-1');
                if (firstExercise) {
                    firstExercise.querySelectorAll('.feedback-panel').forEach(el => {
                        el.style.display = 'none';
                    });
                    firstExercise.querySelectorAll('.option-btn').forEach(btn => {
                        btn.disabled = false;
                    });
                }
        
                // Force a page reload to ensure clean state
                location.reload();
            }
        }

        // Set up event listeners 
        function setupEventListeners() {
            backBtn.addEventListener('click', returnToHomepage);
            
            // Exercise 1: Fact or Opinion 
            document.querySelectorAll('.fact-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    handleFactOpinionAnswer(this, 'fact');
                });
            });
            
            document.querySelectorAll('.opinion-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    handleFactOpinionAnswer(this, 'opinion');
                });
            });
            
            // Exercise 2: Identify Biases - Fixed add bias button
            document.getElementById('add-bias-btn').addEventListener('click', function() {
                const container = document.getElementById('bias-categories-container');
                const newCategory = document.createElement('div');
                newCategory.className = 'bias-category';
                newCategory.innerHTML = `
                    <h3 contenteditable="true">New Category</h3>
                    <textarea class="bias-input" placeholder="Describe how this might influence you"></textarea>
                `;
                container.appendChild(newCategory);
            });
            
            document.getElementById('submit-biases').addEventListener('click', function() {
                completeExercise(2, 30);
            });

            document.getElementById('reset-btn').addEventListener('click', resetProgress);
        }
        
        // Exercise 3: Spot the Bias
        function initExercise3() {
            const overlay = document.getElementById('explanation-overlay');
            const popup = document.getElementById('explanation-popup');
            const explanationText = document.getElementById('explanation-text');
            const closeBtn = document.getElementById('close-explanation');
    
            // Initialize counters
            let totalFound = 0;
            let passage1Found = 0;
            let passage2Found = 0;
            const passage1Count = document.querySelector('#exercise-3 .passage-container:nth-of-type(1) .found-count');
            const passage2Count = document.querySelector('#exercise-3 .passage-container:nth-of-type(2) .found-count');
    
            // Clear previous event listeners by cloning elements
            document.querySelectorAll('#exercise-3 .biased-phrase').forEach(phrase => {
                const newPhrase = phrase.cloneNode(true);
                phrase.parentNode.replaceChild(newPhrase, phrase);
            });

            // Set up new click handlers for biased phrases
            document.querySelectorAll('#exercise-3 .biased-phrase[data-biased="true"]').forEach(phrase => {
                phrase.addEventListener('click', function() {
                    if (!this.classList.contains('found')) {
                        // Mark as found
                        this.classList.add('found');
                
                        // Update counters
                        const passageContainer = this.closest('.passage-container');
                        if (passageContainer.querySelector('.passage-title').textContent.includes("1")) {
                            passage1Found++;
                            passage1Count.textContent = passage1Found;
                        } else {
                            passage2Found++;
                            passage2Count.textContent = passage2Found;
                        }
                        totalFound++;
                        document.getElementById('score-3').textContent = totalFound;
                
                        // Show explanation popup
                        explanationText.textContent = this.dataset.explanation;
                        overlay.style.display = 'block';
                        popup.style.display = 'block';
                
                        // Check for completion
                        if (totalFound === 11) {
                            const earnedXp = 55;
                            document.getElementById('earned-xp-3').textContent = earnedXp;
                            setTimeout(() => {
                                document.getElementById('completion-3').style.display = 'block';
                                completeExercise(3, earnedXp);
                            }, 1000);
                        }
                    }
                });
            });
    
            // Close popup handlers
            closeBtn.addEventListener('click', function() {
                overlay.style.display = 'none';
                popup.style.display = 'none';
            });
    
            overlay.addEventListener('click', function() {
                overlay.style.display = 'none';
                popup.style.display = 'none';
            });
        }

        // New helper function for Exercise 1
        function handleFactOpinionAnswer(button, selectedAnswer) {
            const questionCard = button.closest('.question-card');
            const correctAnswer = questionCard.dataset.correct;
            const feedbackPanel = questionCard.querySelector('.feedback-panel');
            
            // Disable both buttons
            questionCard.querySelectorAll('.option-btn').forEach(btn => {
                btn.disabled = true;
            });
            
            // Show feedback
            feedbackPanel.style.display = 'block';
            
            if (selectedAnswer === correctAnswer) {
                feedbackPanel.classList.add('feedback-correct');
                correctAnswers++;
            } else {
                feedbackPanel.classList.add('feedback-incorrect');
                feedbackPanel.querySelector('p').textContent = 
                    `Incorrect. This is actually a ${correctAnswer}.`;
            }
            
            answeredQuestions++;
            document.getElementById('score-1').textContent = correctAnswers;
            
            // Check if all questions answered
            if (answeredQuestions === 7) {
                const earnedXp = Math.floor((correctAnswers / 7) * 70);
                document.getElementById('earned-xp-1').textContent = earnedXp;
                setTimeout(() => {
                    completeExercise(1, earnedXp);
                    document.getElementById('completion-1').style.display = 'block';
                }, 1000);
            }
        }

        // New helper function for Exercise 3
        function getBiasExplanation(id) {
            const explanations = {
                1: "With a quick internet search on this outlet, you'll find that it is an American conservative news and opinion website.",
                2: "Headline is based on the author's own personal views, because the word 'alarmist' is not attributed to an expert or cited with evidence.",
                3: "Judgment heavy language to paint participants as immature and manipulated by adults.",
                4: "Uses words like 'ditching school' in a way that's meant to tell us this is all a bad thing.",
                5: "Author provides no evidence of this correlation.",
                6: "Provides no evidence of this, suggesting this is based on the author's own personal views.",
                7: "Could have provided evidence, but doesn't. Suggests he is cherry-picking and interpreting his own claim.",
                8: "Characterized as leaning slightly left of center.",
                9: "Language like 'inevitable effects of climate change' is a sign of a liberal outlet.",
                10: "Not an outright sign of bias, but the author could have attributed this fact to experts who have written extensively on the effects of climate change on younger generations so that it did not look like a personal view from the author.",
                11: "Since much of the language up to this point has painted a vivid picture of a worldwide movement in which the students are brave heroes-rallied, taking to the streets-the mention of skipping school doesn't carry the same judgment. By the time readers reach that phrase, they already believe the protests are for a good cause, because the paragraphs before got us emotionally invested."
            };
            return `${id}. ${explanations[id] || 'Biased language detected'}`;
        }

        // Start the game
        initGame();
    </script>
</body>
</html>